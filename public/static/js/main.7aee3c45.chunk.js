(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{215:function(e,t,a){e.exports=a(404)},220:function(e,t,a){},224:function(e,t,a){},403:function(e,t,a){},404:function(e,t,a){"use strict";a.r(t);var n,r=a(0),i=a.n(r),o=a(26),s=a.n(o),c=(a(220),a(90)),l=a(45),u=a.n(l),d=a(206),f=(a(207),a(41)),h=a(27),v=a(31),m=a(66),p=a(190),y=a.n(p);!function(e){e[e.READONLY=0]="READONLY",e[e.DROPPABLE=1]="DROPPABLE",e[e.DRAGGABLE=2]="DRAGGABLE",e[e.DRAG_AND_DROP=3]="DRAG_AND_DROP"}(n||(n={}));var D=a(184),w=a.n(D),g=(a(224),function(e){return i.a.createElement("div",{className:"tooltip icon"},i.a.createElement(w.a,{label:"warning-icon",primaryColor:"#FF991F",secondaryColor:"#FFFAE5",size:"medium"}),i.a.createElement("div",{className:"tooltipText"},e.items))}),E=function(e){var t,a=e.cell,r=a.row,o=a.col,s=JSON.stringify({row:r,col:o}),l=function(e){return e===n.DRAGGABLE||e===n.DRAG_AND_DROP};return i.a.createElement(m.c,{droppableId:s,isDropDisabled:(t=a.cellType,!(t===n.DROPPABLE||t===n.DRAG_AND_DROP))},(function(e,t){return i.a.createElement("div",{ref:e.innerRef,style:(n=t.isDraggingOver,{height:"100%",background:n?"lightblue":"white"})},a.value.map((function(e,t){return i.a.createElement(m.b,{key:e.id,draggableId:e.id,index:t,isDragDisabled:!l(a.cellType)},(function(t,a){return i.a.createElement("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{style:(n=a.isDragging,r=t.draggableProps.style,o=e.color,Object(c.a)({display:"flex",userSelect:"none",padding:"3px",background:n?"lightgreen":o,flexDirection:"row",alignItems:"center",justifyContent:"center"},r))}),e.issue.warnings.length>0?i.a.createElement(g,{items:e.issue.warnings}):null,i.a.createElement("div",{style:{marginLeft:"5px",marginRight:"10px"}},e.title),i.a.createElement("div",{onClick:function(){return t=e.issue.url,console.log(t),void window.open(t,"_blank");var t},style:{cursor:"pointer"}},i.a.createElement(y.a,{label:"open",size:"medium"})));var n,r,o}))})),e.placeholder);var n}))},b=a(24),A=a.n(b),O=function(e,t){for(var a=new Array,n=new Date(e),r=new Date(t);n<=r;)a.push(new Date(n)),n.setDate(n.getDate()+1);return a},k=function(e,t){var a=new Date(e),n=new Date(t),r=A()(a.setDate(a.getDate()-1)),i=A()(n);return Math.trunc(A.a.duration(i.diff(r)).asDays())},j=function(e,t){var a=A()(e),n=A()(t);return a.isSame(n,"year")&&a.isSame(n,"month")&&a.isSame(n,"day")},C=a(107),R=function(){function e(t,a,n,r){Object(h.a)(this,e),this.id=void 0,this.issue=void 0,this.actualPart=void 0,this.totalParts=void 0,this.color=void 0,this.id=Object(C.v4)(),this.issue=t,this.actualPart=a,this.totalParts=n,this.color=r}return Object(v.a)(e,[{key:"isStart",get:function(){return 0===this.actualPart}},{key:"isEnd",get:function(){return this.actualPart===this.totalParts-1}},{key:"isSinglePart",get:function(){return 1===this.totalParts}},{key:"title",get:function(){return this.issue.key}}]),e}(),P=function(e,t){return e.issue.key>t.issue.key?1:e.totalParts<t.totalParts?1:-1},L=a(266),J=function(){function e(t,a,n,r){Object(h.a)(this,e),this.data=new Array,this.users=new Array,this.issues=new Array,this.dates=new Array,this.startDate=void 0,this.endDate=void 0,this.currentDateCol=void 0,this.startDate=n,this.endDate=r,this.currentDateCol=k(n,new Date),this.dates=O(this.startDate,this.endDate),this.users=t,this.issues=a;var i=this.users.length+1,o=k(this.startDate,this.endDate)+1;this.init(i,o)}return Object(v.a)(e,[{key:"createData",value:function(){return this.addDates(),this.addUsers(),this.addIssues(),this.data}},{key:"addDates",value:function(){var e=this;this.dates.forEach((function(t,a){var r=e.createCell(0,a+1,t.toLocaleDateString(),n.READONLY);e.addCell(r)}))}},{key:"addUsers",value:function(){var e=this;this.users.forEach((function(t,a){var r=e.createCell(a+1,0,t.displayName,n.READONLY);e.addCell(r)}))}},{key:"addIssues",value:function(){var e=this,t=new Map,a=new Map;this.issues.forEach((function(r,i){var o=r.startDate?r.startDate:r.created,s=r.dueDate?r.dueDate:e.endDate,c=O(o,s).map((function(e,t,n){var i=a.get(r.key);return i||(i=L({luminosity:"light",format:"rgba",alpha:.8}),a.set(r.key,i)),new R(r,t,n.length,i)})),l=e.dates.findIndex((function(e){return j(e,o)})),u=e.dates.findIndex((function(e){return j(e,s)}));-1!==u&&(u+=1);var d=e.dates.slice(l,u),f=e.users.findIndex((function(e){return e.accountId===r.assignee.accountId}));if(-1===f)throw new Error("No users were found. Without users, issues cannot be displayed");var h=f+1;d.forEach((function(a,r){var i=l+r+1,o=t.get(JSON.stringify({row:h,col:i}));o||(o=[]),o.push(c[r]),t.set(JSON.stringify({row:h,col:i}),o);var s=e.createCell(h,i,o.sort(P),n.DRAG_AND_DROP,E);e.addCell(s)}))}))}},{key:"init",value:function(e,t){for(var a=0;a<e;a++){this.data[a]=[];for(var n=0;n<t;n++){var r=this.getCellType(n),i=this.createCell(a,n,[],r,E);this.addCell(i)}}}},{key:"getCellType",value:function(e){return this.currentDateCol===e?n.DRAG_AND_DROP:this.currentDateCol<e?n.DRAGGABLE:n.READONLY}},{key:"createCell",value:function(e,t,a,n,r){return{row:e,col:t,value:a,DataViewer:r,cellType:n}}},{key:"addCell",value:function(e){this.data[e.row][e.col]=e}}]),e}(),N="".concat("https://bkjira.atlassian.net","/browse/"),S=function e(t,a,n,r,i,o,s){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];Object(h.a)(this,e),this.key=void 0,this.project=void 0,this.assignee=void 0,this.creator=void 0,this.created=void 0,this.startDate=void 0,this.dueDate=void 0,this.url=void 0,this.warnings=void 0,this.key=t,this.project=a,this.assignee=n,this.creator=r,this.created=i,this.startDate=o,this.dueDate=s,this.url="".concat(N).concat(t),this.warnings=c},T=function(){function e(){Object(h.a)(this,e)}return Object(v.a)(e,[{key:"fromJson",value:function(e){return{accountType:e.accountType,accountId:e.accountId,displayName:e.displayName,isActive:e.active}}},{key:"toJson",value:function(e){throw new Error("Method not implemented.")}},{key:"parseArrayFromJson",value:function(e){var t=this,a=new Array;return e.forEach((function(e){var n=t.fromJson(e);n.isActive&&"atlassian"===n.accountType&&a.push(n)})),a}},{key:"parseArrayToJson",value:function(e){throw new Error("Method not implemented.")}}]),e}(),_=function(){function e(){Object(h.a)(this,e)}return Object(v.a)(e,[{key:"fromJson",value:function(e){return{key:e.key,name:e.name}}},{key:"toJson",value:function(e){throw new Error("Method not implemented.")}},{key:"parseArrayFromJson",value:function(e){var t=this,a=new Array;return e.forEach((function(e){a.push(t.fromJson(e))})),a}},{key:"parseArrayToJson",value:function(e){throw new Error("Method not implemented.")}}]),e}(),x=function(){function e(){Object(h.a)(this,e)}return Object(v.a)(e,[{key:"fromJson",value:function(e){var t=new T,a=new _,n=e.key,r=t.fromJson(e.fields.assignee),i=t.fromJson(e.fields.creator),o=new Date(e.fields.created),s=a.fromJson(e.fields.project),c=e.fields.customfield_10015?new Date(e.fields.customfield_10015):void 0,l=e.fields.duedate?new Date(e.fields.duedate):void 0;return new S(n,s,r,i,o,c,l)}},{key:"toJson",value:function(e){throw new Error("Method not implemented.")}},{key:"parseArrayFromJson",value:function(e){var t=this,a=new Array;return e.forEach((function(e){a.push(t.fromJson(e))})),a}},{key:"parseArrayToJson",value:function(e){throw new Error("Method not implemented.")}}]),e}(),F=a(191);var I=a.n(F).a.create({baseURL:"http://localhost:3001"});I.interceptors.request.use((function(e){return e.url=e.url+"?jwt="+window.parent.window.token,e}));var Y=function(){function e(){Object(h.a)(this,e),this.defaultQuery={startDate:A()().startOf("isoWeek").toDate(),endDate:A()().endOf("isoWeek").toDate()}}return Object(v.a)(e,[{key:"loadData",value:function(){var e,t,a,n,r=arguments;return u.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:this.defaultQuery,i.next=3,u.a.awrap(this.getData(e));case 3:return t=i.sent,a=(new T).parseArrayFromJson(t[0].data),n=(new x).parseArrayFromJson(t[1].data.issues),console.log(t[1].data.issues),i.abrupt("return",new J(a,n,e.startDate,e.endDate).createData());case 9:case"end":return i.stop()}}),null,this)}},{key:"getData",value:function(e){var t="/users",a="/issues";if(e){e.userName&&(t="".concat(t,"/").concat(e.userName));var n="";e.issue&&(n="".concat(n,"project=").concat(e.issue,"&"));var r=A()(e.startDate).format("YYYY-MM-DD");n="".concat(n,"created>=").concat(r,"&");var i=A()(e.endDate).format("YYYY-MM-DD");(n="".concat(n,"created<=").concat(i,"&")).endsWith("&")&&(n=n.slice(0,-1)),a="".concat(a,"/").concat(n)}return Promise.all([I.get(t),I.get(a)])}}]),e}(),M=function(e){return function(t){var a,n;return u.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t(G()),r.prev=1,a=new Y,r.next=5,u.a.awrap(a.loadData(e));case 5:n=r.sent,t(U(n)),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),console.log(r.t0),t(B([r.t0]));case 13:case"end":return r.stop()}}),null,null,[[1,9]])}},G=function(){return{type:"FETCH_DATA_REQUEST"}},U=function(e){return{type:"FETCH_DATA_SUCCESS",payload:e}},B=function(e){return{type:"FETCH_DATA_FAILURE",payload:e}},H=function(e,t){return{type:"MOVE",payload:{sourCells:e,destCells:t}}},W=a(38),V=a(117),Q=a(415),q=a(414),z=a(419),$=a(416),K=function(e){var t=function(e){return{width:"25%",flex:"0 1 auto",alignSelf:"auto",marginLeft:0===e?"0":"1%"}},a=e.filterHandler;return i.a.createElement(V.c,{onSubmit:function(e){return a(e)}},(function(e){var a=e.formProps,n=(e.dirty,e.submitting);return i.a.createElement("form",a,i.a.createElement("div",{style:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"space-between"}},i.a.createElement("div",{style:t(0)},i.a.createElement($.a,{label:"Start date",name:"startDate",defaultValue:A()().startOf("isoWeek").format("YYYY-MM-DD")},(function(e){var t=e.fieldProps;e.error,e.valid;return i.a.createElement(q.a,t)}))),i.a.createElement("div",{style:t(1)},i.a.createElement($.a,{label:"End date",name:"endDate",defaultValue:A()().endOf("isoWeek").format("YYYY-MM-DD")},(function(e){var t=e.fieldProps;e.error,e.valid;return i.a.createElement(q.a,t)}))),i.a.createElement("div",{style:t(2)},i.a.createElement($.a,{label:"User",name:"user",defaultValue:""},(function(e){var t=e.fieldProps;e.error,e.valid;return i.a.createElement(z.a,t)}))),i.a.createElement("div",{style:t(3)},i.a.createElement($.a,{label:"Issue",name:"issue",defaultValue:""},(function(e){var t=e.fieldProps;e.error,e.valid;return i.a.createElement(z.a,t)}))),i.a.createElement("div",{style:{width:"10%",flex:"0 1 auto",alignSelf:"center",marginLeft:"1%",marginTop:"30px"}},i.a.createElement(Q.a,{type:"submit",appearance:"primary",isDisabled:n},"Search"))))}))},X=function(e){return e.forEach((function(e){e.style.visibility="hidden"}))},Z=a(203),ee=a.n(Z),te=a(204),ae=a.n(te),ne=(a(403),function(){var e=Object(W.d)((function(e){return e})),t=Object(W.c)();Object(r.useEffect)((function(){e.isLoading||X(document.querySelectorAll(".FloatingRect")),document.body.addEventListener("mousedown",(function(){X(document.querySelectorAll(".ActiveCell"))}),!0)}),[e.isLoading]),Object(r.useEffect)((function(){t(M())}),[]);var a=function(a,n){if(a.droppableId===n.droppableId){var r=JSON.parse(a.droppableId);r.row,r.col}else{var i=JSON.parse(a.droppableId),o=JSON.parse(n.droppableId),s=e.data[i.row][i.col].value[a.index],c={row:i.row,col:i.col},l={row:o.row,col:o.col};t(function(e,t,a){return function(n,r){var i=r(),o=Object(f.a)(i.data),s=t.col,c=s+e.totalParts-e.actualPart,l=o[t.row].slice(s,c).map((function(t){return t.value.find((function(t){return t.issue.key===e.issue.key}))})),u=o[t.row].slice(t.col,t.col+l.length);u.forEach((function(t,a){var n=Object.assign({},t);n.value=t.value.filter((function(t){return t.issue.key!==e.issue.key})),u[a]=n}));var d=o[a.row].slice(a.col,a.col+l.length);d.forEach((function(e){var t=Object.assign({},e),a=l.splice(0,1)[0];t.value.push(a),t.value=t.value.sort(P)})),n(H(u,d))}}(s,c,l))}};return i.a.createElement("div",{className:"container"},i.a.createElement("div",null,i.a.createElement(K,{filterHandler:function(e){var a;return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:a={userName:e.user,issue:e.issue,startDate:new Date(e.startDate),endDate:new Date(e.endDate)},t(M(a));case 2:case"end":return n.stop()}}))}})),i.a.createElement(ee.a,{active:e.isLoading,spinner:i.a.createElement(ae.a,{color:"#0052CC"}),styles:{overlay:function(e){return Object(c.a)({},e,{background:"#D9FFFFFF"})}}},i.a.createElement("div",{className:"calendar"},i.a.createElement(m.a,{onDragEnd:function(e){var t=e.source,n=e.destination;n&&a(t,n)}},i.a.createElement(d.a,{data:e.data})))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var re=a(33),ie=a(205),oe={isLoading:!0,data:[],errors:[]},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REORDER":var a=Object(f.a)(e.data);return t.payload.cells.forEach((function(e){a[e.row][e.col]=Object.assign({},e)})),{isLoading:!1,data:a,errors:[]};case"MOVE":var n=Object(f.a)(e.data),r=t.payload.sourCells.concat(t.payload.destCells);return r.forEach((function(e){n[e.row][e.col]=Object.assign({},e)})),{isLoading:!1,data:n,errors:[]};case"FETCH_DATA_REQUEST":return{isLoading:!0,data:Object(f.a)(e.data),errors:[]};case"FETCH_DATA_SUCCESS":return{isLoading:!1,data:Object(f.a)(t.payload),errors:[]};case"FETCH_DATA_FAILURE":return{isLoading:!1,data:[],errors:Object(f.a)(t.payload)};default:return e}},ce=Object(re.d)(se,Object(re.a)(ie.a));s.a.render(i.a.createElement(W.a,{store:ce},i.a.createElement(ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[215,1,2]]]);
//# sourceMappingURL=main.7aee3c45.chunk.js.map