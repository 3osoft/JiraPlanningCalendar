(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{214:function(e,t,a){e.exports=a(401)},219:function(e,t,a){},401:function(e,t,a){"use strict";a.r(t);var r,n=a(0),o=a.n(n),s=a(26),i=a.n(s),c=(a(219),a(90)),l=a(48),d=a.n(l),u=a(206),f=a(42),p=a(49),v=a(66),h=a(188),D=a.n(h),g=a(190),y=a.n(g),m=a(30);!function(e){e[e.READONLY=0]="READONLY",e[e.DROPPABLE=1]="DROPPABLE",e[e.DRAGGABLE=2]="DRAGGABLE",e[e.DRAG_AND_DROP=3]="DRAG_AND_DROP"}(r||(r={}));var E=function(e){var t=e.cell,a=Object(m.c)(),n=Object(m.d)((function(e){return e})),s=t.row,i=t.col,l=JSON.stringify({row:s,col:i}),d=t.id,u=function(e,t,a){return Object(c.a)({display:"flex",userSelect:"none",padding:"3px",marginTop:"2px",marginBottom:"2px",background:e?"lightgreen":"white",borderStyle:a?"dotted":"none"},t)},f=function(e){p(e)||a(U(e))},p=function(e){return n.selectedItems.find((function(t){return t.draggableId===e.draggableId}))},h=function(e){return{cellId:d,draggableId:e.id,sourcePosition:{row:s,col:i},value:e}};return o.a.createElement(v.c,{droppableId:l},(function(e,a){return o.a.createElement("div",{ref:e.innerRef,style:(n=a.isDraggingOver,{background:n?"lightblue":"white",padding:"8px"})},t.value.map((function(e,a){return o.a.createElement(v.b,{key:e.id,draggableId:e.id,index:a,isDragDisabled:t.cellType===r.DRAGGABLE},(function(t,a){return o.a.createElement("div",Object.assign({ref:t.innerRef},t.draggableProps,{style:u(a.isDragging,t.draggableProps.style,p(h(e)))}),o.a.createElement("div",Object.assign({},t.dragHandleProps,{style:{width:"20px",height:"20px"},onClick:function(t){return function(e,t){e.defaultPrevented||0===e.button&&(e.preventDefault(),f(h(t)))}(t,e)}}),o.a.createElement(D.a,{label:"drag-handle"})),o.a.createElement("div",{style:{marginLeft:"5px",marginRight:"10px"}},e.issue.key),o.a.createElement("div",{onClick:function(){return t=e.issue.url,console.log(t),void window.open(t,"_blank");var t},style:{width:"20px",height:"20px",cursor:"pointer"}},o.a.createElement(y.a,{label:"open"})))}))})),e.placeholder);var n}))},w=a(25),b=a.n(w),O=function(e,t){for(var a=new Array,r=new Date(e);r<=t;)a.push(new Date(r).toLocaleDateString()),r.setDate(r.getDate()+1);return a},A=function(e){return b()(e).isSame(b()(),"day")},I=function(e){return b()(e).isAfter(b()(),"day")},L=a(107),P=function(){function e(t,a,r){Object(f.a)(this,e),this.id=void 0,this.issue=void 0,this.actualPart=void 0,this.totalParts=void 0,this.id=Object(L.v4)(),this.issue=t,this.actualPart=a,this.totalParts=r}return Object(p.a)(e,[{key:"isStart",get:function(){return 0===this.actualPart}},{key:"isEnd",get:function(){return this.actualPart===this.totalParts-1}},{key:"isSinglePart",get:function(){return 1===this.totalParts}}]),e}(),j=function(){function e(t,a,r,n){Object(f.a)(this,e),this.data=new Array,this.users=new Array,this.issues=new Array,this.dates=new Array,this.startDate=void 0,this.endDate=void 0,this.startDate=r,this.endDate=n,this.addDates(),this.addUsers(t),this.addIssues(a),this.create()}return Object(p.a)(e,[{key:"calendarData",get:function(){return this.data}}]),Object(p.a)(e,[{key:"addDates",value:function(){for(var e=O(new Date(this.startDate),new Date(this.endDate)),t=0;t<e.length;t++){var a=this.createCell(0,t+1,e[t],r.READONLY);this.dates.push(a)}}},{key:"addUsers",value:function(e){for(var t=0;t<e.length;t++){var a=this.createCell(t+1,0,e[t].displayName,r.READONLY);this.users.push(a)}}},{key:"addIssues",value:function(e){for(var t=this,a=new Map,n=function(n){var o=e[n],s=O(o.startDate,o.dueDate).map((function(e,t,a){return new P(o,t,a.length)})),i=t.dates.findIndex((function(e){return e.value===o.startDate.toLocaleDateString()})),c=t.dates.findIndex((function(e){return e.value===o.dueDate.toLocaleDateString()}));-1!==c&&(c+=1);var l=t.dates.slice(i,c),d=t.users.find((function(e){return e.value===o.assignee.displayName}));if(!d)throw new Error("No users were found. Without users, issues cannot be displayed");l.forEach((function(e,n){var o,i=e.col,c=d.row,l=a.get(JSON.stringify({row:c,col:i}));l||(l=[]),l.push(s[n]),a.set(JSON.stringify({row:c,col:i}),l);var u=e.value;o=A(u)?r.DRAG_AND_DROP:I(u)?r.DRAGGABLE:r.READONLY,t.issues.push(t.createCell(c,i,l,o,E))}))},o=0;o<e.length;o++)n(o)}},{key:"create",value:function(){for(var e=this,t=this.users.length+1,a=function(e,t){var a=b()(e.setDate(e.getDate()-1)),r=b()(t);return Math.trunc(b.a.duration(r.diff(a)).asDays())}(this.startDate,this.endDate)+1,n=0;n<t;n++){this.data[n]=[];for(var o=0;o<a;o++){var s=this.createCell(n,o,[],r.READONLY);this.addCell(s)}}this.dates.forEach((function(t){e.addCell(t)})),this.users.forEach((function(t){e.addCell(t)})),this.issues.forEach((function(t){e.addCell(t)}))}},{key:"createCell",value:function(e,t,a,r,n){return{row:e,col:t,value:a,DataViewer:n,cellType:r}}},{key:"addCell",value:function(e){this.data[e.row][e.col]=e}}]),e}(),S=a(191);var k=a.n(S).a.create({baseURL:"http://localhost:3001"});k.interceptors.request.use((function(e){return e.url=e.url+"?jwt="+window.parent.window.token,e}));var R="".concat("https://bkjira.atlassian.net","/browse/"),C=function e(t,a,r,n,o,s,i){Object(f.a)(this,e),this.key=void 0,this.project=void 0,this.assignee=void 0,this.creator=void 0,this.created=void 0,this.startDate=void 0,this.dueDate=void 0,this.url=void 0,this.key=t,this.project=a,this.assignee=r,this.creator=n,this.created=o,this.startDate=s,this.dueDate=i,this.url="".concat(R).concat(t)},N=function(){function e(){Object(f.a)(this,e),this.defaultQuery={startDate:b()().startOf("isoWeek").toDate(),endDate:b()().endOf("isoWeek").toDate()}}return Object(p.a)(e,[{key:"loadData",value:function(){var e,t,a,r,n,o,s=arguments;return d.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:this.defaultQuery,r=new C("XAM-5147",a={key:"JPC",name:"Jira planning calendar"},(t=[{displayName:"Adam Blasko",accountId:"0",accountType:"atlassian",isActive:!0},{displayName:"Ben Kusicky",accountId:"1",accountType:"atlassian",isActive:!0}])[0],t[0],new Date,new Date,new Date((new Date).setDate((new Date).getDate()+2))),n=new C("XAM-5777",a,t[1],t[1],new Date,new Date,new Date((new Date).setDate((new Date).getDate()+1))),o=new j(t,[r,n],e.startDate,e.endDate).calendarData,i.abrupt("return",o);case 7:case"end":return i.stop()}}),null,this)}},{key:"getData",value:function(e){var t="/users",a="/issues";if(e){e.userName&&(t="".concat(t,"/").concat(e.userName));var r="";e.issue&&(r="".concat(r,"project=").concat(e.issue,"&"));var n=b()(e.startDate).format("YYYY-MM-DD");r="".concat(r,"created>=").concat(n,"&");var o=b()(e.endDate).format("YYYY-MM-DD");(r="".concat(r,"created<=").concat(o,"&")).endsWith("&")&&(r=r.slice(0,-1)),a="".concat(a,"/").concat(r)}return Promise.all([k.get(t),k.get(a)])}}]),e}(),x=a(117),T=function(e){return function(t){var a,r;return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t(_()),n.prev=1,a=new N,n.next=5,d.a.awrap(a.loadData(e));case 5:r=n.sent,t(Y(r)),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),console.log(n.t0),t(M([n.t0]));case 13:case"end":return n.stop()}}),null,null,[[1,9]])}},_=function(){return{type:"FETCH_DATA_REQUEST"}},Y=function(e){return{type:"FETCH_DATA_SUCCESS",payload:e}},M=function(e){return{type:"FETCH_DATA_FAILURE",payload:e}},F=function(e,t,a,r){return{type:"REORDER",payload:{pos:e,data:function(e,t,a){var r=Array.from(e),n=r.splice(t,1),o=Object(x.a)(n,1)[0];return r.splice(a,0,o),r}(r,t,a)}}},G=function(e,t,a,r,n,o){var s=function(e,t,a,r){var n=Array.from(e),o=Array.from(t),s=n.splice(a.index,1),i=Object(x.a)(s,1)[0];o.splice(r.index,0,i);var c={};return c[a.droppableId]=n,c[r.droppableId]=o,c}(a,r,n,o);return{type:"MOVE",payload:{sourPos:e,sourData:s[n.droppableId],destPos:t,destData:s[o.droppableId]}}},U=function(e){return{type:"SELECT",payload:{multiDragItem:e}}},B=a(118),J=a(412),H=a(411),W=a(415),V=a(413),Q=function(e){var t=function(e){return{width:"25%",flex:"0 1 auto",alignSelf:"auto",marginLeft:0===e?"0":"1%"}},a=e.filterHandler;return o.a.createElement(B.c,{onSubmit:function(e){return a(e)}},(function(e){var a=e.formProps,r=(e.dirty,e.submitting);return o.a.createElement("form",a,o.a.createElement("div",{style:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"space-between"}},o.a.createElement("div",{style:t(0)},o.a.createElement(V.a,{label:"Start date",name:"startDate",defaultValue:b()().startOf("isoWeek").format("YYYY-MM-DD")},(function(e){var t=e.fieldProps;e.error,e.valid;return o.a.createElement(H.a,t)}))),o.a.createElement("div",{style:t(1)},o.a.createElement(V.a,{label:"End date",name:"endDate",defaultValue:b()().endOf("isoWeek").format("YYYY-MM-DD")},(function(e){var t=e.fieldProps;e.error,e.valid;return o.a.createElement(H.a,t)}))),o.a.createElement("div",{style:t(2)},o.a.createElement(V.a,{label:"User",name:"user",defaultValue:""},(function(e){var t=e.fieldProps;e.error,e.valid;return o.a.createElement(W.a,t)}))),o.a.createElement("div",{style:t(3)},o.a.createElement(V.a,{label:"Issue",name:"issue",defaultValue:""},(function(e){var t=e.fieldProps;e.error,e.valid;return o.a.createElement(W.a,t)}))),o.a.createElement("div",{style:{width:"10%",flex:"0 1 auto",alignSelf:"center",marginLeft:"1%",marginTop:"30px"}},o.a.createElement(J.a,{type:"submit",appearance:"primary",isDisabled:r},"Search"))))}))},q=function(e){return e.forEach((function(e){e.style.visibility="hidden"}))},X=a(203),K=a.n(X),$=a(204),z=a.n($),Z=function(){var e=Object(m.d)((function(e){return e})),t=Object(m.c)();Object(n.useEffect)((function(){e.isLoading||q(document.querySelectorAll(".FloatingRect")),document.body.addEventListener("mousedown",(function(){q(document.querySelectorAll(".ActiveCell"))}),!0)}),[e.isLoading]),Object(n.useEffect)((function(){t(T())}),[]);var a=function(t){return e.data[t.row][t.col].value},r=function(e,r){if(e.droppableId===r.droppableId){var n=JSON.parse(e.droppableId),o={row:n.row,col:n.col};t(F(o,e.index,r.index,a(o)))}else{var s=JSON.parse(e.droppableId),i=JSON.parse(r.droppableId),c={row:s.row,col:s.col},l={row:i.row,col:i.col};t(G(c,l,a(c),a(l),e,r))}},s=function(e,a){var r=JSON.parse(e.droppableId),n=JSON.parse(a.droppableId),o={row:r.row,col:r.col},s={row:n.row,col:n.col};t({type:"MULTI_DRAG_SINGLE_DESTINATION",payload:{sourPos:[o],destPos:s}})};return o.a.createElement("div",{style:{paddingTop:"1%",paddingBottom:"1%",paddingLeft:"1.5%",paddingRight:"1.5%",backgroundColor:"white"}},o.a.createElement("div",null,o.a.createElement(Q,{filterHandler:function(e){var a;return d.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:a={userName:e.user,issue:e.issue,startDate:new Date(e.startDate),endDate:new Date(e.endDate)},t(T(a));case 2:case"end":return r.stop()}}))}})),o.a.createElement(K.a,{active:e.isLoading,spinner:o.a.createElement(z.a,{color:"#0052CC"}),styles:{overlay:function(e){return Object(c.a)({},e,{background:"#D9FFFFFF"})}}},o.a.createElement("div",{style:{marginTop:"1%"}},o.a.createElement(v.a,{onDragStart:function(a){e.selectedItems.find((function(e){return e.draggableId===a.draggableId}))||t({type:"UNSELECT_ALL"})},onDragEnd:function(t){var a=t.source,n=t.destination;n&&(e.selectedItems.length>0?s(a,n):r(a,n))}},o.a.createElement(u.a,{style:{".Spreadsheet td":{whiteSpace:"pre"}},data:e.data})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ee=a(32),te=a(205),ae=a(34),re={isLoading:!0,data:[],selectedItems:[],errors:[]},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REORDER":var a=Object.assign({},e.data[t.payload.pos.row][t.payload.pos.col]);a.value=t.payload.data;var r=Object(ae.a)(e.data);return r[t.payload.pos.row][t.payload.pos.col]=a,{isLoading:!1,data:r,selectedItems:[],errors:[]};case"MOVE":var n=Object.assign({},e.data[t.payload.sourPos.row][t.payload.sourPos.col]);n.value=t.payload.sourData;var o=Object.assign({},e.data[t.payload.destPos.row][t.payload.destPos.col]);o.value=t.payload.destData;var s=Object(ae.a)(e.data);return s[t.payload.sourPos.row][t.payload.sourPos.col]=n,s[t.payload.destPos.row][t.payload.destPos.col]=o,{isLoading:!1,data:s,selectedItems:[],errors:[]};case"FETCH_DATA_REQUEST":return{isLoading:!0,data:Object(ae.a)(e.data),selectedItems:[],errors:[]};case"FETCH_DATA_SUCCESS":return{isLoading:!1,data:Object(ae.a)(t.payload),selectedItems:[],errors:[]};case"FETCH_DATA_FAILURE":return{isLoading:!1,data:[],selectedItems:[],errors:Object(ae.a)(t.payload)};case"SELECT":return{isLoading:!1,data:Object(ae.a)(e.data),selectedItems:[].concat(Object(ae.a)(e.selectedItems),[t.payload.multiDragItem]),errors:[]};case"UNSELECT_ALL":return{isLoading:!1,data:Object(ae.a)(e.data),selectedItems:[],errors:[]};case"MULTI_DRAG_SINGLE_DESTINATION":var i=Object(ae.a)(e.data),c=t.payload.destPos.row,l=t.payload.destPos.col,d=Object.assign({},i[c][l]);return e.selectedItems.forEach((function(e){var t=Object.assign({},i[e.sourcePosition.row][e.sourcePosition.col]);t.value=t.value.filter((function(t){return t!==e.value})),d.value.push(e.value),i[e.sourcePosition.row][e.sourcePosition.col]=t})),i[c][l]=d,{isLoading:!1,data:i,selectedItems:[],errors:[]};default:return e}},oe=Object(ee.d)(ne,Object(ee.a)(te.a));i.a.render(o.a.createElement(m.a,{store:oe},o.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[214,1,2]]]);
//# sourceMappingURL=main.f2ea3ef7.chunk.js.map